<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Bible online</title>
</head>
<body>

    <div>
        <h1 class="title">The Bible</h1>
        <input type="text" class="" placeholder="Language">
        <input type="text" class="version" placeholder="Translation">
        <!-- <nav id="menu" class="book">
            <ul>
              <li><a href="#">Enlace 2</a>
                <ul>
                  <li><a href="#">Enlace 2.1</a></li>
                  <li><a href="#">Enlace 2.2</a></li>
                  <li><a href="#">Enlace 2.3</a></li>
                </ul>
              </li>
            </ul>
        </nav> -->
        <input type="text" class="book" placeholder="Book">
        <input type="text" class="chapter" placeholder="Chapter">
        <input type="text" class="verse" placeholder="Verse">


        <button class="btn btn-entrar">Enter</button>
        <button class="btn btn-leer">Read</button>

        <button class="btn record">Advice</button>
        <button class="btn stop">Stop</button>

        <input type="text" name="" id="input" placeholder="Search" style="visibility: hidden;">
    </div>

    <div id="app">
      <p id="advice-text"></p>
    </div>
    <!-- <script src="./faztExample.js" type="module"></script> -->  
    <!-- <script src="scripts.js" type="module"></script> -->

<!--     <script type="module">

      //function runSpeechRecognition() {
        const action = document.querySelector('.record');
        const output = document.querySelector('#app');

        action.addEventListener('click', ()=>{
          var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
          var recognition = new SpeechRecognition();

          recognition.onstart = function() {
              action.innerHTML = "<small>listening</small>";
          };
          
          recognition.onspeechend = function() {
              action.innerHTML = "<small>stopped</small>";
              recognition.stop();
          }

          recognition.onresult = function(event) {
              var transcript = event.results[0][0].transcript;
              output.innerHTML = "<b>Text:</b> " + transcript;
              output.classList.remove("hide");

              console.log(transcript);
              leerVoz(transcript);
          };
        
          recognition.start();
        })


      //}
      </script> -->

      <script type="module">

      import * as phrases from "/modules/phrases.js";

      const action = document.querySelector('.record');
      const output = document.querySelector('#app');
      const stop = document.querySelector('.stop');


        action.addEventListener('click', ()=>{
          var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
          var recognition = new SpeechRecognition();

          recognition.onstart = function() {
              action.innerHTML = "<small>listening</small>";
          };
          
          recognition.onspeechend = function() {
              action.innerHTML = "<small>Advice</small>";
              recognition.stop();
          }

          recognition.onresult = function(event) {
            var transcript = event.results[0][0].transcript;
            output.innerHTML = "<b>Text:</b> " + transcript;
            output.classList.remove("hide");

            let transcriptLower = transcript.toLowerCase() 

            console.log("la transcripcion es: " + transcriptLower);
            leerVoz(transcriptLower);
          };
        
          recognition.start();
        })


      const API_URL = 'https://bolls.life/get-text';

      const HTMLResponse = document.querySelector('#app');
      const ol = document.createElement('ol');


      var Bible = {}
      let versiclesNumberCont = 1;

      let inputVersion = document.querySelector('.version')
      let inputBook = document.querySelector('.book')
      let inputChapter = document.querySelector('.chapter')

      let inputVerse = document.querySelector('.verse')

      const btnLeerTexto = document.querySelector('.btn-leer')
      const btnEntrar = document.querySelector('.btn-entrar')

      const adviceText = document.querySelector('#advice-text')

      let capitulo = '';

      btnEntrar.addEventListener('click', ()=>{

          console.log(`${API_URL}/${inputVersion.value}/${inputBook.value}/${inputChapter.value}/`)

          fetch(`${API_URL}/${inputVersion.value}/${inputBook.value}/${inputChapter.value}/`) //RV1960
          .then((response) => response.json())
          .then((text) => {
            text.forEach((bible) => {
                let elem = document.createElement('li');
                elem.appendChild(
                    document.createTextNode(`${bible.text}`), //${bible.verse}
                    //console.log(bible),
                    Bible[versiclesNumberCont] = `${bible.text} `,
                    versiclesNumberCont++,
                );
                ol.appendChild(elem);
            });

            HTMLResponse.appendChild(ol);

            
            for (let b  in Bible){
                capitulo = capitulo + Bible[b]
            }

            UltimoVersiculo(versiclesNumberCont - 1);
        
          });
      })
      function UltimoVersiculo(versicle){
          console.log(`Last Versicle ${versicle}`); //: ${Bible[versicle]}
      }

      /* function VersicleOrChapter(){
        let emp = inputVerse.value
        console.log(emp)

        if (emp == '') { //* leer capitulo
            locutor.text = textoParaLeer
        }else{ //* leer versiculo
            console.log(Bible[inputVerse.value])
            console.log(Bible)
            locutor.text = Bible[inputVerse.value]
        }
        //leerVoz(capitulo); //leer capitulo
        leerVoz(Bible[30]); //leer versiculo
      } */

      btnLeerTexto.addEventListener('click', ()=>{

        let emp = inputVerse.value
        console.log(emp)
        let textoParaLeer = '';

        if (emp == '') { //* leer capitulo
          textoParaLeer  = capitulo
        }else{ //* leer versiculo
          console.log(Bible[inputVerse.value])
          console.log(Bible)
          textoParaLeer = Bible[inputVerse.value]
        }
        //leerVoz(capitulo); //leer capitulo
        //leerVoz(Bible[30]); //leer versiculo
        leerVoz(textoParaLeer);
      });

      function leerVoz(textoParaLeer){
        
        //btnLeerTexto.addEventListener('click', ()=>{
          const locutor = new SpeechSynthesisUtterance()
          // locutor.lang = 'en-GB'
          // locutor.lang = 'es-MX'
          locutor.lang = 'en-EN'
          // locutor.lang = 'es-MX'
          locutor.pitch = 1;
          locutor.rate = 0.8;

          locutor.text = "I'm sorry. Could you please repeat me? "

          const voz = window.speechSynthesis
          locutor.text = textoParaLeer

          if (textoParaLeer.includes('book')) {
              const finalText = phrases.book[Math.floor(Math.random() * 3)];
              console.log(finalText)
              locutor.text = finalText;

              output.innerHTML = finalText;
          }

          if (textoParaLeer.includes('troubled') || textoParaLeer.includes('sad') || textoParaLeer.includes('not') || textoParaLeer.includes('advice')) {
              const finalText = phrases.troubled[Math.floor(Math.random() * 17)];
              console.log(finalText)
              locutor.text = finalText;

              output.innerHTML = finalText;
          }

          voz.speak(locutor)
         
          stop.addEventListener('click', ()=>{
            voz.cancel();
          })
        //})
      }
      
    </script>
</body>
</html>
